<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>React2Shell Scanner - CVE-2025-55182</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
            text-align: center;
        }

        .header h1 {
            color: #333;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .cve-badge {
            display: inline-block;
            background: #e74c3c;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        .panel h2 {
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        .scan-results {
            margin-top: 20px;
        }

        .step {
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #ddd;
            background: #f8f9fa;
        }

        .step.running {
            border-left-color: #3498db;
            background: #e3f2fd;
        }

        .step.success {
            border-left-color: #27ae60;
            background: #d4edda;
        }

        .step.failed, .step.warning {
            border-left-color: #e74c3c;
            background: #f8d7da;
        }

        .step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .step-title {
            font-weight: 600;
            color: #333;
        }

        .step-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .status-running {
            background: #3498db;
            color: white;
        }

        .status-success {
            background: #27ae60;
            color: white;
        }

        .status-failed, .status-warning {
            background: #e74c3c;
            color: white;
        }

        .step-details {
            color: #555;
            font-size: 0.95em;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
        }

        .terminal {
            background: #1e1e1e;
            color: #0f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 500px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .terminal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .terminal-controls {
            display: flex;
            gap: 10px;
        }

        .terminal-output {
            margin-bottom: 15px;
            overflow-y: auto;
            flex: 1;
        }

        .terminal-line {
            margin-bottom: 5px;
        }

        .terminal-prompt {
            color: #0f0;
            margin-right: 5px;
        }

        .terminal-input-container {
            display: flex;
            align-items: center;
        }

        .terminal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 1em;
            outline: none;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .vulnerability-badge {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-top: 15px;
        }

        .vulnerable {
            background: #e74c3c;
            color: white;
        }

        .not-vulnerable {
            background: #27ae60;
            color: white;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            color: #666;
        }

        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .warning-box h3 {
            color: #856404;
            margin-bottom: 10px;
        }

        .warning-box p {
            color: #856404;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚öõÔ∏è React2Shell Scanner</h1>
            <p class="subtitle">Next.js Server Actions Vulnerability Scanner</p>
            <span class="cve-badge">CVE-2025-55182</span>
        </div>

        <div class="warning-box">
            <h3>‚ö†Ô∏è Legal Warning</h3>
            <p>This tool is for authorized security testing ONLY.</p>
            <p>Unauthorized access to computer systems is illegal. Always obtain written permission before testing.</p>
        </div>

        <div class="main-content">
            <!-- Scanner Panel -->
            <div class="panel">
                <h2>üîç Vulnerability Scanner</h2>
                
                <div class="input-group">
                    <label for="targetUrl">Target URL</label>
                    <input type="text" id="targetUrl" placeholder="https://example.com/" value="https://example.com/">
                </div>

                <button class="btn btn-primary" id="scanBtn" onclick="startScan()">
                    Start Scan
                </button>

                <div id="scanResults" class="scan-results"></div>
            </div>

            <!-- Interactive Shell Panel -->
            <div class="panel">
                <h2>üíª Interactive Shell</h2>

                <div class="tabs">
                    <button class="tab active" onclick="switchTab('shell')">Shell</button>
                    <button class="tab" onclick="switchTab('help')">Help</button>
                </div>

                <div id="shellTab" class="tab-content active">
                    <div id="shellStatus" class="alert alert-info">
                        <strong>‚ÑπÔ∏è Waiting for scan...</strong><br>
                        Run a vulnerability scan to initialize the shell session.
                    </div>

                    <div id="terminalContainer">
                        <div class="terminal" id="terminal">
                            <div class="terminal-header">
                                <span style="color: #0f0;">React2Shell Terminal</span>
                                <div class="terminal-controls">
                                    <button class="btn btn-danger" style="padding: 5px 15px; font-size: 0.9em;" onclick="closeShell()" id="closeShellBtn" disabled>
                                        Close Shell
                                    </button>
                                </div>
                            </div>
                            <div id="terminalOutput" class="terminal-output">
                                <div style="color: #666; text-align: center; padding: 40px 20px;">
                                    <div style="font-size: 3em; margin-bottom: 10px;">‚öõÔ∏è</div>
                                    <div style="font-size: 1.2em; margin-bottom: 10px;">React2Shell Interactive Terminal</div>
                                    <div style="font-size: 0.9em;">Start a scan to activate the shell session</div>
                                </div>
                            </div>
                            <div class="terminal-input-container" id="terminalInputContainer">
                                <span class="terminal-prompt" id="terminalPrompt">user@target:~$</span>
                                <input type="text" class="terminal-input" id="terminalInput" autocomplete="off" onkeypress="handleTerminalInput(event)" disabled>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="helpTab" class="tab-content">
                    <div style="padding: 20px; background: #f8f9fa; border-radius: 8px;">
                        <h3 style="margin-bottom: 15px;">Available Commands</h3>
                        
                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">Special Commands</h4>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-weight: 600; width: 30%;">Command</td>
                                    <td style="padding: 10px; font-weight: 600;">Description</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">cd &lt;path&gt;</td>
                                    <td style="padding: 10px;">Change directory (works on both Windows & Linux)</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">clear</td>
                                    <td style="padding: 10px;">Clear terminal screen</td>
                                </tr>
                            </table>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">Linux Commands</h4>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-weight: 600; width: 30%;">Command</td>
                                    <td style="padding: 10px; font-weight: 600;">Description</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">whoami</td>
                                    <td style="padding: 10px;">Display current username</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">id</td>
                                    <td style="padding: 10px;">Display user ID and group information</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">pwd</td>
                                    <td style="padding: 10px;">Print working directory</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">ls -la</td>
                                    <td style="padding: 10px;">List all files with details</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">cat &lt;file&gt;</td>
                                    <td style="padding: 10px;">Display file contents</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">grep &lt;pattern&gt; &lt;file&gt;</td>
                                    <td style="padding: 10px;">Search for pattern in file</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">find / -name &lt;file&gt;</td>
                                    <td style="padding: 10px;">Search for files by name</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">ps aux</td>
                                    <td style="padding: 10px;">List all running processes</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">netstat -tulpn</td>
                                    <td style="padding: 10px;">Show network connections and ports</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">uname -a</td>
                                    <td style="padding: 10px;">Display system information</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">df -h</td>
                                    <td style="padding: 10px;">Show disk space usage</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">ifconfig / ip addr</td>
                                    <td style="padding: 10px;">Display network interfaces</td>
                                </tr>
                            </table>
                        </div>

                        <div style="margin-bottom: 25px;">
                            <h4 style="color: #667eea; margin-bottom: 10px;">Windows Commands</h4>
                            <table style="width: 100%; border-collapse: collapse;">
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-weight: 600; width: 30%;">Command</td>
                                    <td style="padding: 10px; font-weight: 600;">Description</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">whoami</td>
                                    <td style="padding: 10px;">Display current username</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">echo %cd%</td>
                                    <td style="padding: 10px;">Print current directory</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">dir</td>
                                    <td style="padding: 10px;">List files in directory</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">type &lt;file&gt;</td>
                                    <td style="padding: 10px;">Display file contents</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">findstr &lt;text&gt; &lt;file&gt;</td>
                                    <td style="padding: 10px;">Search for text in file</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">tasklist</td>
                                    <td style="padding: 10px;">List all running processes</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">netstat -ano</td>
                                    <td style="padding: 10px;">Show network connections</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">systeminfo</td>
                                    <td style="padding: 10px;">Display detailed system information</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">ipconfig</td>
                                    <td style="padding: 10px;">Display network configuration</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">set</td>
                                    <td style="padding: 10px;">Display environment variables</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">wmic product get name</td>
                                    <td style="padding: 10px;">List installed software</td>
                                </tr>
                                <tr style="border-bottom: 1px solid #ddd;">
                                    <td style="padding: 10px; font-family: monospace;">reg query &lt;key&gt;</td>
                                    <td style="padding: 10px;">Query Windows registry</td>
                                </tr>
                            </table>
                        </div>

                        <h3 style="margin-top: 25px; margin-bottom: 15px;">Usage Examples</h3>
                        <div style="background: #1e1e1e; color: #0f0; padding: 15px; border-radius: 8px; font-family: monospace; font-size: 0.9em;">
                            <div style="color: #3af; margin-bottom: 10px;">// Linux Examples</div>
                            <div>user@target:~$ whoami</div>
                            <div style="color: #fff; margin-left: 20px;">ubuntu</div>
                            <div style="margin-top: 10px;">user@target:~$ ls -la</div>
                            <div style="color: #fff; margin-left: 20px;">drwxr-xr-x 4 ubuntu ubuntu 4096 Jan 29 10:30 .</div>
                            <div style="margin-top: 10px;">user@target:~$ cat /etc/passwd</div>
                            <div style="color: #fff; margin-left: 20px;">root:x:0:0:root:/root:/bin/bash</div>
                            <div style="color: #fff; margin-left: 20px;">ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash</div>
                            
                            <div style="color: #3af; margin-top: 20px; margin-bottom: 10px;">// Windows Examples</div>
                            <div>C:\Users\Admin> whoami</div>
                            <div style="color: #fff; margin-left: 20px;">DESKTOP-ABC123\Admin</div>
                            <div style="margin-top: 10px;">C:\Users\Admin> dir</div>
                            <div style="color: #fff; margin-left: 20px;">Directory of C:\Users\Admin</div>
                            <div style="margin-top: 10px;">C:\Users\Admin> systeminfo</div>
                            <div style="color: #fff; margin-left: 20px;">Host Name: DESKTOP-ABC123</div>
                            <div style="color: #fff; margin-left: 20px;">OS Name: Microsoft Windows 10 Pro</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p><strong>Disclaimer:</strong> This tool is for educational and authorized testing purposes only.</p>
            <p>The authors are not responsible for any misuse or damage caused by this tool.</p>
        </div>
    </div>

    <script>
        let currentScanId = null;
        let currentSessionId = null;
        let scanInterval = null;
        let currentTargetUrl = null;

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        async function startScan() {
            const targetUrl = document.getElementById('targetUrl').value.trim();
            
            if (!targetUrl) {
                alert('Please enter a target URL');
                return;
            }

            currentTargetUrl = targetUrl;
            const scanBtn = document.getElementById('scanBtn');
            const resultsDiv = document.getElementById('scanResults');
            
            scanBtn.disabled = true;
            scanBtn.innerHTML = '<span class="loading"></span> Scanning...';
            resultsDiv.innerHTML = '<div class="alert alert-info">Scan in progress...</div>';

            try {
                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ targetUrl })
                });

                const data = await response.json();
                currentScanId = data.scanId;

                // Poll for results
                scanInterval = setInterval(updateScanResults, 1000);
            } catch (error) {
                resultsDiv.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
                scanBtn.disabled = false;
                scanBtn.innerHTML = 'Start Scan';
            }
        }

        async function updateScanResults() {
            if (!currentScanId) return;

            try {
                const response = await fetch(`/api/scan/${currentScanId}`);
                const data = await response.json();

                let html = '';
                
                // Render steps
                data.steps.forEach(step => {
                    html += `
                        <div class="step ${step.status}">
                            <div class="step-header">
                                <span class="step-title">${step.step}</span>
                                <span class="step-status status-${step.status}">${step.status.toUpperCase()}</span>
                            </div>
                            <div class="step-details">${step.details}</div>
                        </div>
                    `;
                });

                // Show vulnerability status
                if (data.status === 'completed') {
                    clearInterval(scanInterval);
                    
                    if (data.vulnerable) {
                        html += `
                            <div class="vulnerability-badge vulnerable">
                                ‚ö†Ô∏è TARGET IS VULNERABLE
                            </div>
                        `;
                        
                        // Automatically start shell session
                        setTimeout(() => {
                            autoStartShell();
                        }, 1000);
                    } else {
                        html += `
                            <div class="vulnerability-badge not-vulnerable">
                                ‚úì TARGET IS NOT VULNERABLE
                            </div>
                        `;
                    }
                    
                    document.getElementById('scanBtn').disabled = false;
                    document.getElementById('scanBtn').innerHTML = 'Start Scan';
                }

                document.getElementById('scanResults').innerHTML = html;
            } catch (error) {
                console.error('Error updating scan results:', error);
            }
        }

        async function startShell() {
            if (!currentTargetUrl) {
                addTerminalLine('Error: No target URL available', 'error');
                return;
            }

            try {
                // Update status
                document.getElementById('shellStatus').innerHTML = '<strong>üîÑ Connecting...</strong><br>Establishing shell session...';
                
                const response = await fetch('/api/session/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ targetUrl: currentTargetUrl })
                });

                const data = await response.json();
                currentSessionId = data.sessionId;

                // Clear placeholder and show welcome message
                document.getElementById('terminalOutput').innerHTML = '';
                document.getElementById('shellStatus').style.display = 'none';
                document.getElementById('terminalInput').disabled = false;
                document.getElementById('closeShellBtn').disabled = false;
                document.getElementById('terminalInput').focus();

                addTerminalLine('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó', 'header');
                addTerminalLine('‚ïë          Interactive Shell Session Started            ‚ïë', 'header');
                addTerminalLine('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù', 'header');
                addTerminalLine('', 'output');
                addTerminalLine('‚úì Connected to target successfully', 'success');
                addTerminalLine('‚úì Shell session initialized', 'success');
                addTerminalLine('', 'output');
                addTerminalLine('Available commands:', 'info');
                addTerminalLine('  cd <path>      - Change directory', 'info');
                addTerminalLine('  clear          - Clear terminal screen', 'info');
                addTerminalLine('  Any command    - Execute system commands (Linux/Windows)', 'info');
                addTerminalLine('', 'output');
                addTerminalLine('Type your commands below:', 'info');
                addTerminalLine('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ', 'output');
                addTerminalLine('', 'output');
            } catch (error) {
                addTerminalLine(`Error starting shell: ${error.message}`, 'error');
                document.getElementById('shellStatus').innerHTML = `<strong class="danger">‚ùå Connection Failed</strong><br>${error.message}`;
            }
        }

        async function autoStartShell() {
            // Automatically start shell when vulnerability is detected
            document.getElementById('shellStatus').innerHTML = '<strong>üéâ Target is vulnerable!</strong><br>Starting interactive shell...';
            await startShell();
        }

        async function handleTerminalInput(event) {
            if (event.key === 'Enter') {
                const input = document.getElementById('terminalInput');
                const command = input.value.trim();
                
                if (!command) return;

                // Handle clear command
                if (command === 'clear') {
                    document.getElementById('terminalOutput').innerHTML = '';
                    input.value = '';
                    return;
                }

                addTerminalLine(`${document.getElementById('terminalPrompt').textContent} ${command}`, 'command');
                input.value = '';

                try {
                    const response = await fetch('/api/session/execute', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            sessionId: currentSessionId, 
                            command 
                        })
                    });

                    const data = await response.json();
                    
                    if (data.output) {
                        addTerminalLine(data.output, 'output');
                    }

                    // Update prompt
                    if (data.currentDir || data.rootMode !== undefined) {
                        updatePrompt(data.currentDir, data.rootMode);
                    }

                    // Ensure scroll to bottom after output is added
                    setTimeout(() => {
                        const output = document.getElementById('terminalOutput');
                        output.scrollTop = output.scrollHeight;
                    }, 100);

                } catch (error) {
                    addTerminalLine(`Error: ${error.message}`, 'error');
                }
            }
        }

        function addTerminalLine(text, type = 'output') {
            const output = document.getElementById('terminalOutput');
            const line = document.createElement('div');
            line.className = 'terminal-line';
            
            if (type === 'command') {
                line.style.color = '#fff';
                line.style.fontWeight = 'bold';
            } else if (type === 'error') {
                line.style.color = '#f00';
            } else if (type === 'success') {
                line.style.color = '#0f0';
                line.style.fontWeight = 'bold';
            } else if (type === 'info') {
                line.style.color = '#3af';
            } else if (type === 'header') {
                line.style.color = '#0f0';
                line.style.fontWeight = 'bold';
                line.style.textAlign = 'center';
            }
            
            line.textContent = text;
            output.appendChild(line);
            
            // Force scroll to bottom with multiple methods for reliability
            output.scrollTop = output.scrollHeight;
            
            // Also try scrolling the parent terminal
            const terminal = document.getElementById('terminal');
            if (terminal) {
                terminal.scrollTop = terminal.scrollHeight;
            }
            
            // Use requestAnimationFrame for smooth scrolling
            requestAnimationFrame(() => {
                output.scrollTop = output.scrollHeight;
                if (terminal) {
                    terminal.scrollTop = terminal.scrollHeight;
                }
            });
        }

        function updatePrompt(currentDir, rootMode) {
            const user = rootMode ? 'root' : 'user';
            const dir = currentDir || '~';
            const prompt = `${user}@target:${dir}$`;
            document.getElementById('terminalPrompt').textContent = prompt;
        }

        async function toggleRootMode() {
            try {
                const response = await fetch('/api/session/execute', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        sessionId: currentSessionId, 
                        command: '.root'
                    })
                });

                const data = await response.json();
                
                addTerminalLine(data.output, 'info');
                
                if (data.rootMode !== undefined) {
                    document.getElementById('rootModeStatus').textContent = data.rootMode ? 'ON' : 'OFF';
                    updatePrompt(data.currentDir, data.rootMode);
                }
            } catch (error) {
                addTerminalLine(`Error: ${error.message}`, 'error');
            }
        }

        function closeShell() {
            if (confirm('Are you sure you want to close the shell session?')) {
                // Reset terminal
                document.getElementById('terminalOutput').innerHTML = `
                    <div style="color: #666; text-align: center; padding: 40px 20px;">
                        <div style="font-size: 3em; margin-bottom: 10px;">‚öõÔ∏è</div>
                        <div style="font-size: 1.2em; margin-bottom: 10px;">React2Shell Interactive Terminal</div>
                        <div style="font-size: 0.9em;">Start a scan to activate the shell session</div>
                    </div>
                `;
                
                // Disable controls
                document.getElementById('terminalInput').disabled = true;
                document.getElementById('terminalInput').value = '';
                document.getElementById('closeShellBtn').disabled = true;
                
                // Show status message
                document.getElementById('shellStatus').style.display = 'block';
                document.getElementById('shellStatus').innerHTML = '<strong>‚ÑπÔ∏è Session closed</strong><br>Run a new scan to start another session.';
                
                // Clear session
                currentSessionId = null;
            }
        }
    </script>
</body>
</html>